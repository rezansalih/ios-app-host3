<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LevelMaster - Survey App</title>
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3f37c9;
            --secondary: #4cc9f0;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --text: #333;
            --text-light: #777;
            --bg: #f8f9fa;
            --card-bg: rgba(255, 255, 255, 0.85);
            --border: rgba(0, 0, 0, 0.1);
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            --glass: rgba(255, 255, 255, 0.25);
            --radius: 16px;
            --transition: all 0.3s ease;
            --font: 'Segoe UI', system-ui, sans-serif;
        }

        [data-theme="dark"] {
            --primary: #4895ef;
            --primary-dark: #4361ee;
            --secondary: #4cc9f0;
            --text: #f5f5f5;
            --text-light: #bbb;
            --bg: #121212;
            --card-bg: rgba(30, 30, 30, 0.85);
            --border: rgba(255, 255, 255, 0.1);
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            --glass: rgba(30, 30, 30, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            transition: var(--transition);
            background-attachment: fixed;
            background-size: cover;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
            z-index: -1;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            animation: slideInDown 0.6s ease-out;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 42px;
            height: 42px;
            background: var(--primary);
            color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
        }

        .logo-text {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-controls {
            display: flex;
            gap: 15px;
        }

        .icon-btn {
            background: var(--card-bg);
            border: 1px solid var(--border);
            color: var(--text);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
        }

        .icon-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        .language-select {
            padding: 10px 15px;
            border-radius: 50px;
            border: 1px solid var(--border);
            background: var(--card-bg);
            color: var(--text);
            cursor: pointer;
            font-weight: 500;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            transition: var(--transition);
        }

        .language-select:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        .tabs {
            display: flex;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            margin-bottom: 30px;
            padding: 8px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease-out;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            color: var(--text);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border-radius: 12px;
            position: relative;
            z-index: 1;
            overflow: hidden;
        }

        .tab-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary);
            z-index: -1;
            opacity: 0;
            transform: scale(0.8);
            transition: var(--transition);
            border-radius: 12px;
        }

        .tab-btn.active {
            color: white;
        }

        .tab-btn.active::before {
            opacity: 1;
            transform: scale(1);
        }

        .tab-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }

        .tab-content {
            display: none;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            animation: fadeIn 0.5s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .input-card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 20px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .input-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .input-group input {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--border);
            border-radius: 12px;
            background: var(--card-bg);
            color: var(--text);
            font-size: 1rem;
            transition: var(--transition);
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1rem;
            box-shadow: var(--shadow);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(1px);
        }

        .primary-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .secondary-btn {
            background: var(--card-bg);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 25px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            transition: var(--transition);
            text-align: center;
            animation: popIn 0.4s ease-out;
        }

        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .result-card h3 {
            font-size: 1rem;
            margin-bottom: 15px;
            color: var(--text-light);
            font-weight: 600;
        }

        .result-card p {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text);
        }

        .history-section {
            margin-top: 30px;
        }

        .history-section h3 {
            margin-bottom: 20px;
            font-size: 1.2rem;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .history-table-container {
            overflow-x: auto;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            background: var(--glass);
            backdrop-filter: blur(10px);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
            font-weight: 600;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.05);
        }

        .cut {
            color: var(--danger);
            font-weight: bold;
        }

        .fill {
            color: var(--success);
            font-weight: bold;
        }

        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }

        .export-card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 25px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .export-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .export-card h4 {
            margin-bottom: 15px;
            font-size: 1.1rem;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .export-format select, .export-language select {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--border);
            border-radius: 12px;
            background: var(--card-bg);
            color: var(--text);
            margin-top: 5px;
            transition: var(--transition);
        }

        .export-format select:focus, .export-language select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .export-btn-container {
            grid-column: 1 / -1;
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        /* Animations */
        @keyframes slideInDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes popIn {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            70% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .input-grid, .results-grid, .export-options {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .logo {
                justify-content: center;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            .tab-btn span {
                display: none;
            }
            
            .tab-btn {
                padding: 12px;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <div class="logo">
                <div class="logo-icon">LM</div>
                <div class="logo-text">LevelMaster</div>
            </div>
            <div class="header-controls">
                <button id="darkModeToggle" class="icon-btn" title="Toggle Dark Mode">
                    <svg width="20" height="20" viewBox="0 0 24 24">
                        <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1-8.313-12.454z" fill="currentColor"/>
                    </svg>
                </button>
                <select id="languageSelect" class="language-select">
                    <option value="en">English</option>
                    <option value="ar">العربية</option>
                    <option value="ku">Kurdî</option>
                </select>
            </div>
        </header>

        <div class="tabs">
            <button class="tab-btn active" data-tab="measurements" id="measurementsTab">
                <svg width="20" height="20" viewBox="0 0 24 24">
                    <path d="M3 17l6-6 4 4 8-8" stroke="currentColor" stroke-width="2" fill="none"/>
                    <path d="M14 7l7 7-7 7" stroke="currentColor" stroke-width="2" fill="none"/>
                </svg>
                <span>Measurements</span>
            </button>
            <button class="tab-btn" data-tab="results" id="resultsTab">
                <svg width="20" height="20" viewBox="0 0 24 24">
                    <path d="M22 12h-4l-3 9L9 3l-3 9H2" stroke="currentColor" stroke-width="2" fill="none"/>
                </svg>
                <span>Results</span>
            </button>
            <button class="tab-btn" data-tab="export" id="exportTab">
                <svg width="20" height="20" viewBox="0 0 24 24">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="2" fill="none"/>
                    <polyline points="7 10 12 15 17 10" stroke="currentColor" stroke-width="2" fill="none"/>
                    <line x1="12" y1="15" x2="12" y2="3" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span>Export</span>
            </button>
        </div>

        <div class="tab-content active" id="measurements-tab">
            <div class="input-grid">
                <div class="input-card">
                    <div class="input-group">
                        <label for="benchMark" id="benchMarkLabel">Bench Mark (BM):</label>
                        <input type="number" id="benchMark" step="0.001" placeholder="Enter BM value">
                    </div>
                    
                    <div class="input-group">
                        <label for="backSight" id="backSightLabel">Back Sight (BS):</label>
                        <input type="number" id="backSight" step="0.001" placeholder="Enter BS value">
                    </div>
                    
                    <div class="input-group">
                        <label for="foreSight" id="foreSightLabel">Fore Sight (FS):</label>
                        <input type="number" id="foreSight" step="0.001" placeholder="Enter FS value">
                    </div>
                </div>
                
                <div class="input-card">
                    <div class="input-group">
                        <label for="intermediateSight" id="intermediateSightLabel">Intermediate Sight (IS):</label>
                        <input type="number" id="intermediateSight" step="0.001" placeholder="Enter IS value">
                    </div>
                    
                    <div class="input-group">
                        <label for="upperReading" id="upperReadingLabel">Upper Reading:</label>
                        <input type="number" id="upperReading" step="0.001" placeholder="Enter upper reading">
                    </div>
                    
                    <div class="input-group">
                        <label for="lowerReading" id="lowerReadingLabel">Lower Reading:</label>
                        <input type="number" id="lowerReading" step="0.001" placeholder="Enter lower reading">
                    </div>
                </div>
                
                <div class="input-card">
                    <div class="input-group">
                        <label for="groundLevel" id="groundLevelLabel">Ground Level (GL):</label>
                        <input type="number" id="groundLevel" step="0.001" placeholder="Enter GL value">
                    </div>
                    
                    <div class="input-group">
                        <label for="formationLevel" id="formationLevelLabel">Formation Level (FL):</label>
                        <input type="number" id="formationLevel" step="0.001" placeholder="Enter FL value">
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button id="calculateBtn" class="btn primary-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24">
                        <path d="M9 10h6m-6 4h6m2-11H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z" stroke="white" stroke-width="2" fill="none"/>
                    </svg>
                    <span id="calculateBtnText">Calculate</span>
                </button>
                <button id="resetBtn" class="btn secondary-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24">
                        <path d="M2.5 2v6h6M2.66 15.57a10 10 0 1 0 1.17-9.87" stroke="currentColor" stroke-width="2" fill="none"/>
                    </svg>
                    <span id="resetBtnText">Reset</span>
                </button>
            </div>
        </div>

        <div class="tab-content" id="results-tab">
            <div class="results-grid">
                <div class="result-card">
                    <h3 id="hiResultTitle">Height of Instrument (HI)</h3>
                    <p id="hiResultValue">-</p>
                </div>
                
                <div class="result-card">
                    <h3 id="rlResultTitle">Reduced Level (RL)</h3>
                    <p id="rlResultValue">-</p>
                </div>
                
                <div class="result-card">
                    <h3 id="distanceResultTitle">Distance</h3>
                    <p id="distanceResultValue">-</p>
                </div>
                
                <div class="result-card">
                    <h3 id="cutFillResultTitle">Cut/Fill</h3>
                    <p id="cutFillResultValue">-</p>
                </div>
            </div>
            
            <div class="history-section">
                <h3 id="historyTitle">
                    <svg width="24" height="24" viewBox="0 0 24 24">
                        <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" fill="none"/>
                    </svg>
                    <span>Measurement History</span>
                </h3>
                <div class="history-table-container">
                    <table id="historyTable">
                        <thead>
                            <tr>
                                <th id="historyBM">BM</th>
                                <th id="historyBS">BS</th>
                                <th id="historyIS">IS</th>
                                <th id="historyFS">FS</th>
                                <th id="historyHI">HI</th>
                                <th id="historyRL">RL</th>
                                <th id="historyDistance">Distance</th>
                                <th id="historyCutFill">Cut/Fill</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Results will be added here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="tab-content" id="export-tab">
            <div class="export-options">
                <div class="export-card">
                    <h4>
                        <svg width="24" height="24" viewBox="0 0 24 24">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" fill="none"/>
                            <polyline points="14 2 14 8 20 8" stroke="currentColor" stroke-width="2" fill="none"/>
                            <path d="M16 13H8" stroke="currentColor" stroke-width="2" fill="none"/>
                            <path d="M16 17H8" stroke="currentColor" stroke-width="2" fill="none"/>
                            <path d="M10 9H9H8" stroke="currentColor" stroke-width="2" fill="none"/>
                        </svg>
                        <span id="exportFormatLabel">Export Format</span>
                    </h4>
                    <div class="export-format">
                        <select id="exportFormat">
                            <option value="csv">CSV (Comma Separated)</option>
                            <option value="txt">TXT (Plain Text)</option>
                        </select>
                    </div>
                </div>
                
                <div class="export-card">
                    <h4>
                        <svg width="24" height="24" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z" stroke="currentColor" stroke-width="2" fill="none"/>
                            <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" fill="none"/>
                        </svg>
                        <span id="exportLanguageLabel">Export Language</span>
                    </h4>
                    <div class="export-language">
                        <select id="exportLanguage">
                            <option value="en">English</option>
                            <option value="ar">العربية</option>
                            <option value="ku">Kurdî</option>
                        </select>
                    </div>
                </div>
                
                <div class="export-btn-container">
                    <button id="exportBtn" class="btn primary-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="white" stroke-width="2" fill="none"/>
                            <polyline points="7 10 12 15 17 10" stroke="white" stroke-width="2" fill="none"/>
                            <line x1="12" y1="15" x2="12" y2="3" stroke="white" stroke-width="2"/>
                        </svg>
                        <span id="exportBtnText">Export Data</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Language translations
        const translations = {
            en: {
                appTitle: "LevelMaster",
                benchMarkLabel: "Bench Mark (BM):",
                backSightLabel: "Back Sight (BS):",
                foreSightLabel: "Fore Sight (FS):",
                intermediateSightLabel: "Intermediate Sight (IS):",
                upperReadingLabel: "Upper Reading:",
                lowerReadingLabel: "Lower Reading:",
                groundLevelLabel: "Ground Level (GL):",
                formationLevelLabel: "Formation Level (FL):",
                calculateBtn: "Calculate",
                hiResultTitle: "Height of Instrument (HI)",
                rlResultTitle: "Reduced Level (RL)",
                distanceResultTitle: "Distance",
                cutFillResultTitle: "Cut/Fill",
                historyTitle: "Measurement History",
                historyBM: "BM",
                historyBS: "BS",
                historyIS: "IS",
                historyFS: "FS",
                historyHI: "HI",
                historyRL: "RL",
                historyDistance: "Distance",
                historyCutFill: "Cut/Fill",
                exportTitle: "Export Data",
                exportFormatLabel: "Export Format",
                exportLanguageLabel: "Export Language",
                exportBtn: "Export Data",
                measurementsTab: "Measurements",
                resultsTab: "Results",
                exportTab: "Export",
                cut: "Cut",
                fill: "Fill",
                none: "None",
                csvExportHeader: "BM,BS,IS,FS,HI,RL,Distance,Cut/Fill",
                resetBtn: "Reset"
            },
            ar: {
                appTitle: "LevelMaster",
                benchMarkLabel: "علامة الأساس (BM):",
                backSightLabel: "الرؤية الخلفية (BS):",
                foreSightLabel: "الرؤية الأمامية (FS):",
                intermediateSightLabel: "الرؤية المتوسطة (IS):",
                upperReadingLabel: "القراءة العليا:",
                lowerReadingLabel: "القراءة السفلى:",
                groundLevelLabel: "مستوى الأرض (GL):",
                formationLevelLabel: "مستوى التكوين (FL):",
                calculateBtn: "حساب",
                hiResultTitle: "ارتفاع الأداة (HI)",
                rlResultTitle: "المستوى المخفض (RL)",
                distanceResultTitle: "المسافة",
                cutFillResultTitle: "حفر/ردم",
                historyTitle: "سجل القياسات",
                historyBM: "BM",
                historyBS: "BS",
                historyIS: "IS",
                historyFS: "FS",
                historyHI: "HI",
                historyRL: "RL",
                historyDistance: "المسافة",
                historyCutFill: "حفر/ردم",
                exportTitle: "تصدير البيانات",
                exportFormatLabel: "صيغة التصدير",
                exportLanguageLabel: "لغة التصدير",
                exportBtn: "تصدير البيانات",
                measurementsTab: "القياسات",
                resultsTab: "النتائج",
                exportTab: "تصدير",
                cut: "حفر",
                fill: "ردم",
                none: "لا شيء",
                csvExportHeader: "BM,BS,IS,FS,HI,RL,المسافة,حفر/ردم",
                resetBtn: "إعادة تعيين"
            },
            ku: {
                appTitle: "LevelMaster",
                benchMarkLabel: "Nîşana Bingehê (BM):",
                backSightLabel: "Dîtina Paş (BS):",
                foreSightLabel: "Dîtina Pêş (FS):",
                intermediateSightLabel: "Dîtina Navîn (IS):",
                upperReadingLabel: "Xwendina Jorîn:",
                lowerReadingLabel: "Xwendina Jêrîn:",
                groundLevelLabel: "Asta Erdê (GL):",
                formationLevelLabel: "Asta Avakirinê (FL):",
                calculateBtn: "Hesab bike",
                hiResultTitle: "Bilindahiya Amûrê (HI)",
                rlResultTitle: "Asta Kêmkirî (RL)",
                distanceResultTitle: "Dûrî",
                cutFillResultTitle: "Birrîn / Tijekirin",
                historyTitle: "Dîroka Pîvanê",
                historyBM: "BM",
                historyBS: "BS",
                historyIS: "IS",
                historyFS: "FS",
                historyHI: "HI",
                historyRL: "RL",
                historyDistance: "Dûrî",
                historyCutFill: "Birrîn/Tijekirin",
                exportTitle: "Daneyan Derxîne",
                exportFormatLabel: "Formata Deranînê",
                exportLanguageLabel: "Zimanê Deranînê",
                exportBtn: "Daneyan Derxîne",
                measurementsTab: "Pîvan",
                resultsTab: "Encam",
                exportTab: "Derxistin",
                cut: "Birrîn",
                fill: "Tijekirin",
                none: "Tiştek",
                csvExportHeader: "BM,BS,IS,FS,HI,RL,Dûrî,Birrîn/Tijekirin",
                resetBtn: "Reset bike"
            }
        };

        // DOM Elements
        const darkModeToggle = document.getElementById('darkModeToggle');
        const languageSelect = document.getElementById('languageSelect');
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        const calculateBtn = document.getElementById('calculateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const exportBtn = document.getElementById('exportBtn');

        // Input fields
        const benchMarkInput = document.getElementById('benchMark');
        const backSightInput = document.getElementById('backSight');
        const foreSightInput = document.getElementById('foreSight');
        const intermediateSightInput = document.getElementById('intermediateSight');
        const upperReadingInput = document.getElementById('upperReading');
        const lowerReadingInput = document.getElementById('lowerReading');
        const groundLevelInput = document.getElementById('groundLevel');
        const formationLevelInput = document.getElementById('formationLevel');

        // Result fields
        const hiResultValue = document.getElementById('hiResultValue');
        const rlResultValue = document.getElementById('rlResultValue');
        const distanceResultValue = document.getElementById('distanceResultValue');
        const cutFillResultValue = document.getElementById('cutFillResultValue');
        const historyTable = document.getElementById('historyTable').querySelector('tbody');

        // Export elements
        const exportFormat = document.getElementById('exportFormat');
        const exportLanguage = document.getElementById('exportLanguage');

        // Measurement history
        let measurementsHistory = [];

        // Initialize the app
        function initApp() {
            // Check for saved theme preference
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }

            // Check for saved language preference
            const savedLanguage = localStorage.getItem('language') || 'en';
            languageSelect.value = savedLanguage;
            setLanguage(savedLanguage);

            // Set up event listeners
            setupEventListeners();
        }

        // Set up event listeners
        function setupEventListeners() {
            // Dark mode toggle
            darkModeToggle.addEventListener('click', toggleDarkMode);

            // Language change
            languageSelect.addEventListener('change', (e) => {
                const lang = e.target.value;
                localStorage.setItem('language', lang);
                setLanguage(lang);
            });

            // Tab switching
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabName = button.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });

            // Calculate button
            calculateBtn.addEventListener('click', calculateResults);

            // Reset button
            resetBtn.addEventListener('click', resetForm);

            // Export button
            exportBtn.addEventListener('click', exportData);
        }

        // Toggle dark mode
        function toggleDarkMode() {
            const html = document.documentElement;
            if (html.getAttribute('data-theme') === 'dark') {
                html.removeAttribute('data-theme');
                localStorage.setItem('theme', 'light');
            } else {
                html.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
            }
        }

        // Switch tabs
        function switchTab(tabName) {
            tabButtons.forEach(button => {
                button.classList.remove('active');
                if (button.getAttribute('data-tab') === tabName) {
                    button.classList.add('active');
                }
            });

            tabContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === `${tabName}-tab`) {
                    content.classList.add('active');
                }
            });
        }

        // Set language
        function setLanguage(lang) {
            const translation = translations[lang];
            for (const key in translation) {
                const elements = document.querySelectorAll(`[id="${key}"]`);
                elements.forEach(el => {
                    if (el.tagName === 'INPUT' && el.placeholder) {
                        el.placeholder = translation[key];
                    } else {
                        el.textContent = translation[key];
                    }
                });
            }
        }

        // Reset form
        function resetForm() {
            benchMarkInput.value = '';
            backSightInput.value = '';
            foreSightInput.value = '';
            intermediateSightInput.value = '';
            upperReadingInput.value = '';
            lowerReadingInput.value = '';
            groundLevelInput.value = '';
            formationLevelInput.value = '';
            
            hiResultValue.textContent = '-';
            rlResultValue.textContent = '-';
            distanceResultValue.textContent = '-';
            cutFillResultValue.textContent = '-';
            cutFillResultValue.className = '';
            
            measurementsHistory = [];
            updateHistoryTable();
        }

        // Calculate survey results
        function calculateResults() {
            const benchMark = parseFloat(benchMarkInput.value) || 0;
            const backSight = parseFloat(backSightInput.value) || 0;
            const foreSight = parseFloat(foreSightInput.value) || 0;
            const intermediateSight = parseFloat(intermediateSightInput.value) || 0;
            const upperReading = parseFloat(upperReadingInput.value) || 0;
            const lowerReading = parseFloat(lowerReadingInput.value) || 0;
            const groundLevel = parseFloat(groundLevelInput.value) || 0;
            const formationLevel = parseFloat(formationLevelInput.value) || 0;

            // Calculate Height of Instrument (HI)
            // HI should only be recalculated when a new Back Sight (BS) is entered
            // Formula: HI = Last Reduced Level (RL) + new Back Sight (BS)
            // For the first measurement with BM: HI = BM + BS
            let heightOfInstrument;
            
            if (backSight > 0) {
                // New Back Sight entered - recalculate HI
                if (measurementsHistory.length > 0) {
                    // Use the last Reduced Level from history + new Back Sight
                    const lastMeasurement = measurementsHistory[measurementsHistory.length - 1];
                    heightOfInstrument = lastMeasurement.reducedLevel + backSight;
                } else {
                    // First measurement: use Bench Mark + Back Sight
                    heightOfInstrument = benchMark + backSight;
                }
            } else {
                // No new Back Sight - use the same HI as the last measurement
                if (measurementsHistory.length > 0) {
                    heightOfInstrument = measurementsHistory[measurementsHistory.length - 1].heightOfInstrument;
                } else {
                    // This should not happen in normal surveying workflow
                    // First measurement should always have a BM and BS
                    heightOfInstrument = benchMark;
                }
            }

            // Calculate Reduced Level (RL)
            let reducedLevel;
            if (foreSight > 0) {
                reducedLevel = heightOfInstrument - foreSight;
            } else if (intermediateSight > 0) {
                reducedLevel = heightOfInstrument - intermediateSight;
            } else {
                reducedLevel = heightOfInstrument;
            }

            // Calculate Distance
            const distance = (upperReading - lowerReading) * 100;

            // Calculate Cut/Fill
            let cutFillValue = groundLevel - formationLevel;
            let cutFillText, cutFillClass;
            
            if (cutFillValue > 0) {
                cutFillText = `${translations[languageSelect.value].cut}: ${cutFillValue.toFixed(3)}`;
                cutFillClass = 'cut';
            } else if (cutFillValue < 0) {
                cutFillText = `${translations[languageSelect.value].fill}: ${Math.abs(cutFillValue).toFixed(3)}`;
                cutFillClass = 'fill';
            } else {
                cutFillText = translations[languageSelect.value].none;
                cutFillClass = '';
            }

            // Update result displays
            hiResultValue.textContent = heightOfInstrument.toFixed(3);
            rlResultValue.textContent = reducedLevel.toFixed(3);
            distanceResultValue.textContent = distance.toFixed(3);
            cutFillResultValue.textContent = cutFillText;
            cutFillResultValue.className = cutFillClass;

            // Add to history
            const measurement = {
                benchMark,
                backSight,
                foreSight,
                intermediateSight,
                heightOfInstrument,
                reducedLevel,
                distance,
                cutFill: cutFillText,
                cutFillClass,
                timestamp: new Date().toISOString()
            };
            
            measurementsHistory.push(measurement);
            updateHistoryTable();

            // Switch to results tab
            switchTab('results');
        }

        // Update history table
        function updateHistoryTable() {
            const lang = languageSelect.value;
            historyTable.innerHTML = '';
            
            measurementsHistory.forEach(measurement => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${measurement.benchMark.toFixed(3)}</td>
                    <td>${measurement.backSight.toFixed(3)}</td>
                    <td>${measurement.intermediateSight.toFixed(3)}</td>
                    <td>${measurement.foreSight.toFixed(3)}</td>
                    <td>${measurement.heightOfInstrument.toFixed(3)}</td>
                    <td>${measurement.reducedLevel.toFixed(3)}</td>
                    <td>${measurement.distance.toFixed(3)}</td>
                    <td class="${measurement.cutFillClass}">${measurement.cutFill}</td>
                `;
                
                historyTable.appendChild(row);
            });
        }

        // Export data
        function exportData() {
            const format = exportFormat.value;
            const lang = exportLanguage.value;
            const translation = translations[lang];
            
            if (measurementsHistory.length === 0) {
                alert('No data to export');
                return;
            }
            
            let content;
            
            if (format === 'csv') {
                // CSV export
                content = translation.csvExportHeader + '\n';
                
                measurementsHistory.forEach(measurement => {
                    content += `${measurement.benchMark.toFixed(3)},${measurement.backSight.toFixed(3)},${measurement.intermediateSight.toFixed(3)},${measurement.foreSight.toFixed(3)},${measurement.heightOfInstrument.toFixed(3)},${measurement.reducedLevel.toFixed(3)},${measurement.distance.toFixed(3)},"${measurement.cutFill}"\n`;
                });
            } else {
                // TXT export
                content = `${translation.appTitle} - ${new Date().toLocaleString()}\n\n`;
                content += `${translation.historyTitle}:\n\n`;
                
                // Create header
                const headers = [
                    translation.historyBM,
                    translation.historyBS,
                    translation.historyIS,
                    translation.historyFS,
                    translation.historyHI,
                    translation.historyRL,
                    translation.historyDistance,
                    translation.historyCutFill
                ];
                
                content += headers.join('\t') + '\n';
                
                // Add data rows
                measurementsHistory.forEach(measurement => {
                    content += [
                        measurement.benchMark.toFixed(3),
                        measurement.backSight.toFixed(3),
                        measurement.intermediateSight.toFixed(3),
                        measurement.foreSight.toFixed(3),
                        measurement.heightOfInstrument.toFixed(3),
                        measurement.reducedLevel.toFixed(3),
                        measurement.distance.toFixed(3),
                        measurement.cutFill
                    ].join('\t') + '\n';
                });
            }
            
            // Create download link
            const blob = new Blob([content], { type: format === 'csv' ? 'text/csv' : 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `survey_data_${new Date().toISOString().slice(0, 10)}.${format}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Show visual feedback
            exportBtn.innerHTML = `<svg width="20" height="20" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7" stroke="white" stroke-width="2" fill="none"/></svg> <span>${translation.exportBtn} ✓</span>`;
            setTimeout(() => {
                exportBtn.innerHTML = `<svg width="20" height="20" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="white" stroke-width="2" fill="none"/><polyline points="7 10 12 15 17 10" stroke="white" stroke-width="2" fill="none"/><line x1="12" y1="15" x2="12" y2="3" stroke="white" stroke-width="2"/></svg> <span>${translation.exportBtn}</span>`;
            }, 2000);
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>